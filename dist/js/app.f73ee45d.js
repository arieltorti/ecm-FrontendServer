(function(t){function e(e){for(var i,o,s=e[0],l=e[1],u=e[2],c=0,d=[];c<s.length;c++)o=s[c],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);m&&m(e);while(d.length)d.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,s=1;s<n.length;s++){var l=n[s];0!==a[l]&&(i=!1)}i&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},a={app:0},r=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/static/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var m=l;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var i=n("85ec"),a=n.n(i);a.a},1:function(t,e){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("fieldset",[n("legend",[t._v("Choose a model:")]),n("select",{directives:[{name:"model",rawName:"v-model",value:t.modelSelected,expression:"modelSelected"}],attrs:{name:"model",id:"model"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.modelSelected=e.target.multiple?n:n[0]}}},t._l(t.modelList,(function(e,i){return n("option",{key:i,domProps:{value:i}},[t._v(t._s(e.name))])})),0)]),n("CurrentModel",{attrs:{modelSelected:t.modelSelected,currentModel:t.currentModel}}),t.modelSelected?n("Editor",{attrs:{model:t.currentModel,simulation:t.simulation}}):t._e(),t.modelSelected?n("fieldset",[n("legend",[t._v("Simulation")]),n("button",{staticStyle:{margin:"1em",padding:"0.4em 0.8em","font-size":"1.15em"},on:{click:t.simulate}},[t._v("Simulate")]),n("Simulation",{attrs:{sim:t.currentSimulation,"sim-cancel":t.simCancel,"sim-state":t.simulationState},on:{"sim-start":t.handleSimStart,"sim-error":t.handleSimError,"sim-done":t.handleSimDone,"sim-cancel":t.handleSimCancel}})],1):t._e()],1)},r=[],o=(n("4160"),n("b0c0"),n("b64b"),n("d3b7"),n("159b"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("fieldset",[n("legend",[t._v("Simulation parameters")]),n("details",[n("summary",[t._v("General")]),n("label",{attrs:{for:"days"}},[t._v("Days:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.simulation.days,expression:"simulation.days",modifiers:{number:!0}}],attrs:{name:"days",type:"number"},domProps:{value:t.simulation.days},on:{input:function(e){e.target.composing||t.$set(t.simulation,"days",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),n("label",{attrs:{for:"step"}},[t._v("Step:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.simulation.step,expression:"simulation.step",modifiers:{number:!0}}],attrs:{name:"step",type:"number"},domProps:{value:t.simulation.step},on:{input:function(e){e.target.composing||t.$set(t.simulation,"step",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),n("details",[n("summary",[t._v("Initial conditions")]),t._l(t.model.compartments,(function(e){return n("Condition",{key:e.name,attrs:{comp:e,simulation:t.simulation}})}))],2),n("details",[n("summary",[t._v("Params")]),t._l(t.model.params,(function(e){return n("Param",{key:e.name,attrs:{param:e,simulation:t.simulation}})}))],2)])}),s=[],l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("strong",[t._v(t._s(t.param.name))]),t.param.iterable?n("div",[n("label",{attrs:{for:"param"}},[t._v("with range:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.simulation.iterate.key,expression:"simulation.iterate.key"}],attrs:{type:"radio",id:"param"},domProps:{value:t.param.name,checked:t._q(t.simulation.iterate.key,t.param.name)},on:{click:function(e){return t.paramUncheck(t.param.name)},change:function(e){return t.$set(t.simulation.iterate,"key",t.param.name)}}})]):t._e(),t.simulation.iterate.key==t.param.name?n("div",[n("label",{attrs:{for:t.param+"Start"}},[t._v("Start:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.simulation.iterate.start,expression:"simulation.iterate.start",modifiers:{number:!0}}],attrs:{id:t.param+"Start",type:"number"},domProps:{value:t.simulation.iterate.start},on:{input:function(e){e.target.composing||t.$set(t.simulation.iterate,"start",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),n("label",{attrs:{for:t.param+"End"}},[t._v("End:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.simulation.iterate.end,expression:"simulation.iterate.end",modifiers:{number:!0}}],attrs:{id:t.param+"End",type:"number"},domProps:{value:t.simulation.iterate.end},on:{input:function(e){e.target.composing||t.$set(t.simulation.iterate,"end",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),n("label",{attrs:{for:t.param+"Intervals"}},[t._v("Intervals:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.simulation.iterate.intervals,expression:"simulation.iterate.intervals",modifiers:{number:!0}}],attrs:{id:t.param+"Intervals",type:"number"},domProps:{value:t.simulation.iterate.intervals},on:{input:function(e){e.target.composing||t.$set(t.simulation.iterate,"intervals",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]):n("div",[n("label",{attrs:{for:t.param}},[t._v("Value:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.simulation.params[t.param.name],expression:"simulation.params[param.name]",modifiers:{number:!0}}],attrs:{type:"number",id:t.param},domProps:{value:t.simulation.params[t.param.name]},on:{input:function(e){e.target.composing||t.$set(t.simulation.params,t.param.name,t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])])},u=[],m={props:["param","simulation"],methods:{paramUncheck:function(t){this.simulation.iterate.key==t&&(this.simulation.iterate.key=null)}}},c=m,d=n("2877"),p=Object(d["a"])(c,l,u,!1,null,null,null),f=p.exports,h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("label",{attrs:{for:t.comp}},[n("strong",[t._v(t._s(t.comp.name)+"_0:")])]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.simulation.initial_conditions[t.comp.name],expression:"simulation.initial_conditions[comp.name]",modifiers:{number:!0}}],attrs:{type:"number"},domProps:{value:t.simulation.initial_conditions[t.comp.name]},on:{input:function(e){e.target.composing||t.$set(t.simulation.initial_conditions,t.comp.name,t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])},v=[],g={props:["comp","simulation"]},_=g,S=Object(d["a"])(_,h,v,!1,null,null,null),b=S.exports,y={props:["model","simulation"],components:{Param:f,Condition:b}},E=y,M=Object(d["a"])(E,o,s,!1,null,null,null),O=M.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{position:"relative"}},[t.simState===t.SIM_STATE.INPROGRESS?n("div",{staticClass:"progress"},[t._v("Simulating")]):t._e(),t.simState===t.SIM_STATE.FAILED?n("div",{staticClass:"errorMsg"},[t._v("Error: "+t._s(t.errMsg))]):t._e(),t._m(0),t.simState===t.SIM_STATE.DONE&&t.isMultiple?n("div",{attrs:{id:"plotAnimDiv"}},[n("button",{on:{click:t.handleAnimClick}},[t._v(t._s(t.playing?"| |":"â–¶"))])]):t._e()])},w=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"plotDiv"}})}],C=(n("99af"),n("a15b"),n("d81d"),n("fb6a"),n("a9e3"),n("35b3"),n("3ca3"),n("ddb0"),n("2b3d"),n("5530")),D={DONE:0,INPROGRESS:1,CANCELED:2,FAILED:3},k="simulationModel",$={yaxis:{fixedrange:!0},xaxis:{title:"Days"}},N=n("030a"),P={props:["sim","simCancel","simState"],data:function(){return{SIM_STATE:D,graphHistoricData:[],stats:{totalSteps:null,currentStep:null},errMsg:"",abortSignal:null,playing:!1}},computed:{isMultiple:function(){return this.sim&&null!=this.sim.simulation.iterate.key}},watch:{sim:function(t){null!=t&&this.simulate()},simCancel:function(t){t&&(this.abortSignal.abort(),this.$emit("sim-cancel"))}},methods:{handleError:function(t){var e=this;t.ABORT_ERR&&t.code===t.ABORT_ERR?(console.log("Request aborted"),this.$emit("sim-cancel")):(t.json().then((function(t){e.errMsg=t.error})),this.$emit("sim-error"))},stop:function(){},_play:function(){var t=this;N["animate"]("plotDiv",null,{mode:"immediate",fromcurrent:!0,transition:{duration:300},frame:{duration:500,redraw:!1}}).then((function(){return t.playing=!1}))},_pause:function(){N["animate"]("plotDiv",[null],{mode:"immediate",fromcurrent:!0,transition:{duration:0},frame:{duration:0,redraw:!1}})},handleAnimClick:function(){this.playing?this._pause():this._play(),this.playing=!this.playing},simulate:function(){var t=this;if(null!=this.sim){console.log("Simulating",this.sim),this.$emit("sim-start"),this.graphHistoricData=[];var e=JSON.parse(JSON.stringify(this.sim.simulation));if(this.isMultiple){if(0===this.sim.simulation.iterate.intervals)return}else delete e.iterate;this._simulate(e,this.sim.model.id).then((function(){return t.dataFetchingDone()})).catch((function(e){return t.handleError(e)}))}},_simulate:function(t,e){var n=this,i=new AbortController,a=i.signal;this.abortSignal=i;var r=fetch("/simulate/".concat(e),{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},method:"POST",body:JSON.stringify(t),signal:a});return r.then((function(t){if(t.status>=400&&t.status<600)throw t;return t.json()})).then((function(t){if(n.isMultiple)t.forEach((function(t,e){var i=L(t);i._iterVal=e,n.graphHistoricData.push(i)}));else{var e=L(t);e._iterVal=0,n.graphHistoricData.push(e)}}))},_preciseRound:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7;return Math.round((t+Number.EPSILON)*Math.pow(10,e))/Math.pow(10,e)},_getIndexAsString:function(t){return"".concat(this.graphHistoricData[t]._iterVal||t)},dataFetchingDone:function(){this.$emit("sim-done");for(var t=[],e=0;e<this.graphHistoricData.length;e++)t.push({method:"animate",label:this._getIndexAsString(e),args:[[this._getIndexAsString(e)],{mode:"next",transition:{duration:400,easing:"linear"},frame:{duration:800,redraw:!0}}]});for(var n=[{pad:{l:130,t:55},steps:t}],i=[],a=0;a<this.graphHistoricData.length;a++)i.push({name:this._getIndexAsString(a),data:this.graphHistoricData[a]});var r=JSON.parse(JSON.stringify(this.graphHistoricData[0]));N["newPlot"]("plotDiv",{data:r,layout:Object(C["a"])(Object(C["a"])({},$),{},{sliders:n}),frames:i,config:T})}}};function j(){function t(t){return"0".concat(t).slice(0,2)}var e=new Date,n=t(e.getMonth()+1),i=t(e.getDate()),a=t(e.getHours()),r=t(e.getMinutes()),o=t(e.getSeconds());return"".concat(e.getUTCFullYear()).concat(n).concat(i,"-").concat(a).concat(r).concat(o)}function I(t){var e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("download","sim-".concat(j(),".csv")),document.body.appendChild(e),e.click(),e.remove()}function R(t){for(var e="sampletimes,".concat(t.data.map((function(t){return t.name})).join(",")),n=t.data[0].x,i=t.data.map((function(t){return t.y})),a=e+"\r\n",r=function(t){a+="".concat(n[t],", ").concat(i.map((function(e){return e[t]})).join(","),"\n")},o=0;o<n.length;o++)r(o);var s=new Blob([a],{type:"text/csv"});I(window.URL.createObjectURL(s))}var A={name:"Export as CSV",icon:N["Icons"].disk,click:function(t){R(t)}},T={displaylogo:!1,modeBarButtons:[[A],["toImage","zoom2d","zoomIn2d","zoomOut2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian"]],modeBarButtonsToRemove:["pan2d","resetScale2d","sendDataToCloud"]};function L(t){for(var e=t.columns,n=[],i=0;i<t.data.length;i++)n.push({x:e,y:t.data[i],name:t.index[i]});return n}var U=P,H=Object(d["a"])(U,x,w,!1,null,null,null),B=H.exports,J=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.modelSelected?n("fieldset",[n("legend",[t._v("Model Details")]),n("h3",[t._v("Reactions")]),t._l(t.currentModel.reactions,(function(e){return n("div",{key:e.name,staticClass:"reaction"},[n("div",[t._v(t._s(e.sfrom)+" -> "+t._s(e.sto)+": "+t._s(e.function))])])})),t.currentModel.expressions?n("div",[n("h3",[t._v("Where")]),t._l(t.currentModel.expressions,(function(e){return n("div",{key:e.name,staticClass:"expression"},[n("div",[t._v(t._s(e.name)+" = "+t._s(e.value))])])}))],2):t._e()],2):t._e()},F=[],G={props:["currentModel","modelSelected"]},V=G,z=Object(d["a"])(V,J,F,!1,null,null,null),q=z.exports,W={beforeMount:function(){this.fetchModels()},data:function(){return{SIM_STATE:D,simulationState:D.DONE,errorMsg:null,statusMsg:null,modelList:{},currentModel:{},modelSelected:1,simulation:{step:1,days:365,initial_conditions:{},params:{},iterate:{key:null,start:0,end:1,intervals:10}},currentSimulation:null,simCancel:!1,pendingChanges:!0}},components:{Simulation:B,Editor:O,CurrentModel:q},computed:{modelVariables:function(){return Object.keys(this.simulation.params)}},watch:{simulationModel:function(t){this.pendingChanges=!0,localStorage.setItem(k,t)},modelSelected:function(t){var e=t in this.modelList?this.modelList[t]:{params:[],compartments:[]},n=this.simulation;return e.compartments.forEach((function(t){n.initial_conditions[t.name]=t.default})),e.params.forEach((function(t){n.params[t.name]=t.default})),this.simulation=n,this.currentModel=e,e}},methods:{simulate:function(){this.simulationState===D.INPROGRESS?this.stopSimulation():this.buildSimulation()},fetchModels:function(){var t=this,e=fetch("/api/models/");e.then((function(e){if(e.status>=400&&e.status<600)throw e;e.json().then((function(e){e.models.forEach((function(e){t.modelList[e.id]=e})),t.modelSelected=0}))}))},buildSimulation:function(){var t=this;this.currentSimulation={model:this.currentModel,simulation:this.simulation},setTimeout((function(){t.pendingChanges=!1}),0)},stopSimulation:function(){this.simCancel=!0},setError:function(t){this.errorMsg="[ERROR]: ".concat(t),this.statusMsg=null},setStatus:function(t){this.errorMsg=null,this.statusMsg=t},handleError:function(t){console.error(t),this.setError(t.message)},handleSubmit:function(t){this.simulationState===D.INPROGRESS?this.stopSimulation():this.buildSimulation(t)},handleSimStart:function(){this.simulationState=D.INPROGRESS},handleSimError:function(){this.simulationState=D.FAILED},handleSimDone:function(){this.simulationState=D.DONE},handleSimCancel:function(){this.simulationState=D.CANCELED,this.simCancel=!1}}},Y=W,K=(n("034f"),Object(d["a"])(Y,a,r,!1,null,null,null)),Q=K.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(t){return t(Q)}}).$mount("#app")},"85ec":function(t,e,n){}});
//# sourceMappingURL=app.f73ee45d.js.map